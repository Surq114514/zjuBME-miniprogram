<view class="container">
  <image src="/images/bg.jpg" class="bg-image"></image>
  <view class="page-header" style="margin-bottom: 20px;">
    <text class="header-title" style="font-size: 22px; font-weight: 600;">康复训练计划</text>
    <text class="header-desc" style="font-size: 14px; color: black; display: block; margin-top: 4px;">根据您的恢复阶段，定制专属训练计划</text>
  </view>
  
  <!-- 阶段切换 -->
  <view class="tabs">
      <view class="tab {{currentStage === 0 ? 'active' : ''}}" bindtap="switchStage" data-stage="0">
        阶段一
        <text style="font-weight: 600;" wx:if='{{0===realStage}}'>（当前阶段）</text>
      </view>
      <view class="tab {{currentStage === 1 ? 'active' : ''}}" bindtap="switchStage" data-stage="1">
        阶段二
        <text style="font-weight: 600;" wx:if='{{1===realStage}}'>（当前阶段）</text>
      </view>
      <view class="tab {{currentStage === 2 ? 'active' : ''}}" bindtap="switchStage" data-stage="2">
        阶段三
        <text style="font-weight: 600;" wx:if='{{3===realStage}}'>（当前阶段）</text>
      </view>
      <view class="tab {{currentStage === 3 ? 'active' : ''}}" bindtap="switchStage" data-stage="3">
        阶段四
        <text style="font-weight: 600;" wx:if='{{4===realStage}}'>（当前阶段）</text>
      </view>
    </view>
    
  <!-- 阶段选项卡1 -->
  <view class="tab-content" wx:if="{{currentStage === 0}}">
    <!-- 阶段信息 -->
    <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color: #fff5e5">
      <view style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <text style="font-size: 16px; font-weight: 600;">术后第1阶段</text>
        <text style="font-size: 14px; color: #6bb37e;">time1.1-time1.2</text>
      </view>
    
      <view style="margin-bottom: 16px;">
        <text style="font-size: 15px; display: block; margin-bottom: 8px;">阶段目标：</text>
        <view style="padding-left: 16px; display: flex; flex-direction: column; gap: 4px;">
          <text style="font-size: 14px; color: var(--gray-dark);">{{currentStage === realStage ? planInfo.stageGoal : '暂无' }}</text>
        </view>
      </view>
    
      <view class="stage-progress" wx:if='{{currentStage === realStage}}'>
        <view style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <text style="font-size: 15px;">阶段完成度</text>
          <text style="font-size: 15px; font-weight: 600;">{{planInfo.stageRate}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width:{{planInfo.stageRate}}%; background-color: #6bb37e;"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 阶段选项卡2 -->
  <view class="tab-content" wx:if="{{currentStage === 1}}">
    <!-- 阶段信息 -->
    <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color: #fff5e5">
      <view style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <text style="font-size: 16px; font-weight: 600;">术后第2阶段</text>
        <text style="font-size: 14px; color: #6bb37e;">{{stageStartDate}}-{{planInfo.stageEndDate === null ? '至今' : stageEndDate}}</text>
      </view>
    
      <view style="margin-bottom: 16px;">
        <text style="font-size: 15px; display: block; margin-bottom: 8px;">阶段目标：</text>
        <view style="padding-left: 16px; display: flex; flex-direction: column; gap: 4px;">
          <text style="font-size: 14px; color: var(--gray-dark);">{{currentStage === realStage ? planInfo.stageGoal : '暂无' }}</text>
        </view>
      </view>
    
      <view class="stage-progress" wx:if='{{currentStage === realStage}}'>
        <view style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <text style="font-size: 15px;">阶段完成度</text>
          <text style="font-size: 15px; font-weight: 600;">{{planInfo.stageRate}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width:{{planInfo.stageRate}}%; background-color: #6bb37e;"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 阶段选项卡3 -->
  <view class="tab-content" wx:if="{{currentStage === 2}}">
    <!-- 阶段信息 -->
    <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color: #fff5e5">
      <view style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <text style="font-size: 16px; font-weight: 600;">术后第3阶段</text>
        <text style="font-size: 14px; color: #6bb37e;">time3.1-time3.2</text>
      </view>
    
      <view style="margin-bottom: 16px;">
        <text style="font-size: 15px; display: block; margin-bottom: 8px;">阶段目标：</text>
        <view style="padding-left: 16px; display: flex; flex-direction: column; gap: 4px;">
          <text style="font-size: 14px; color: var(--gray-dark);">{{currentStage === realStage ? planInfo.stageGoal : '暂无' }}</text>
        </view>
      </view>
    
      <view class="stage-progress" wx:if='{{currentStage === realStage}}'>
        <view style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <text style="font-size: 15px;">阶段完成度</text>
          <text style="font-size: 15px; font-weight: 600;">{{planInfo.stageRate}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width:{{planInfo.stageRate}}%; background-color: #6bb37e;"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 阶段选项卡4 -->
  <view class="tab-content" wx:if="{{currentStage === 3}}">
    <!-- 阶段信息 -->
    <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color: #fff5e5">
      <view style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <text style="font-size: 16px; font-weight: 600;">术后第4阶段</text>
        <text style="font-size: 14px; color: #6bb37e;">time4.1-time4.2</text>
      </view>
    
      <view style="margin-bottom: 16px;">
        <text style="font-size: 15px; display: block; margin-bottom: 8px;">阶段目标：</text>
        <view style="padding-left: 16px; display: flex; flex-direction: column; gap: 4px;">
          <text style="font-size: 14px; color: var(--gray-dark);">{{currentStage === realStage ? planInfo.stageGoal : '暂无' }}</text>
        </view>
      </view>
    
      <view class="stage-progress" wx:if='{{currentStage === realStage}}'>
        <view style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <text style="font-size: 15px;">阶段完成度</text>
          <text style="font-size: 15px; font-weight: 600;">{{planInfo.stageRate}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width:{{planInfo.stageRate}}%; background-color: #6bb37e;"></view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 每日计划 -->
  <view class="daily-plan section">
    <text class="section-title">本周训练计划</text>
    
    <view class="tabs">
      <view class="tab {{currentDay === 0 ? 'active' : ''}}" bindtap="switchDay" data-day="0">
        周一
      </view>
      <view class="tab {{currentDay === 1 ? 'active' : ''}}" bindtap="switchDay" data-day="1">
        周二
      </view>
      <view class="tab {{currentDay === 2 ? 'active' : ''}}" bindtap="switchDay" data-day="2">
        周三
      </view>
      <view class="tab {{currentDay === 3 ? 'active' : ''}}" bindtap="switchDay" data-day="3">
        周四
      </view>
      <view class="tab {{currentDay === 4 ? 'active' : ''}}" bindtap="switchDay" data-day="4">
        周五
      </view>
      <view class="tab {{currentDay === 5 ? 'active' : ''}}" bindtap="switchDay" data-day="5">
        周六
      </view>
      <view class="tab {{currentDay === 6 ? 'active' : ''}}" bindtap="switchDay" data-day="6">
        周日
      </view>
    </view>
    
    <!-- 每日计划选项卡1 -->
    <view class="tab-content" wx:if="{{currentDay === 0}}">
      <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color:#fff5e5"> 
        <!-- 今日任务 -->
        <view class="task-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <text style="font-size: 16px; font-weight: 600;">{{(currentDay === oldDay) ? '本日计划' : '周一计划'}}</text>
          <text class="task-count" style="font-size: 14px; {{tasksCompleted === totalTasks ? 'color: var(--secondary);' : 'color: var(--primary);'}}">{{tasksCompleted}}/{{totalTasks}}</text>
        </view>
        <view style="display: flex;">
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:if="{{currentDay < oldDay}}">已完成</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:elif="{{currentDay > oldDay}}">待设定</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:else >正在进行</text>
        </view>
        <!-- 可勾画任务栏核心 -->
        <view class="stage-info card card-shadow" style="display: flex; align-items: center; padding:15px 10px; border-bottom: 0.5px solid var(--gray-medium); {{item.completed ? 'background-color: #d2ffd9;' : 'background-color: white;'}}" wx:for="{{todayTasks}}" wx:key="id">
          <view class="task-check {{item.completed ? 'done' : 'undone'}}" 
                style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; {{item.completed ? 'background-color: var(--secondary);' : 'background-color: #fff5e5; border: 2rpx solid var(--gray-medium)'}}"
                bindtap="toggleTaskCompletion" data-id="{{item.id}}">
            <icon type="success" size="16" color="white" wx:if="{{item.completed}}" />
          </view>
          <view class="task-info" style="flex: 1;">
            <text class="task-name" style="font-size: 15px; display: block; {{item.completed ? 'text-decoration: line-through; color: var(--gray-dark);' : ''}}">{{item.name}}</text>
            <text class="task-detail" style="font-size: 13px; color: var(--gray-dark);">{{item.sets}} 组 × {{item.reps}}</text>            
            <text style="font-size: 12px; color:#4A90E2;" class="click-text" bindtap="openModal" data-desc="{{item.description}}" data-diffic="{{item.difficulty}}">\n查看详情> 
            </text>
          </view>       
          <text class="task-status {{item.completed ? 'done' : 'undone'}}" style="font-size: 14px; {{item.completed ? 'color: var(--secondary);' : 'color: var(--gray-dark);'}}">{{item.completed ? '已完成' : '未完成'}}</text>
        </view>   
      </view>   
    </view>

    <!-- 每日计划选项卡2 -->
    <view class="tab-content" wx:if="{{currentDay === 1}}">
      <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color:#fff5e5"> 
        <!-- 今日任务 -->
        <view class="task-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <text style="font-size: 16px; font-weight: 600;">{{(currentDay === oldDay) ? '本日计划' : '周二计划'}}</text>
          <text class="task-count" style="font-size: 14px; {{tasksCompleted === totalTasks ? 'color: var(--secondary);' : 'color: var(--primary);'}}">{{tasksCompleted}}/{{totalTasks}}</text>
        </view>
        <view style="display: flex;">
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:if="{{currentDay < oldDay}}">已完成</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:elif="{{currentDay > oldDay}}">待设定</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:else >正在进行</text>
        </view>
        <!-- 可勾画任务栏核心 -->
        <view class="stage-info card card-shadow" style="display: flex; align-items: center; padding:15px 10px; border-bottom: 0.5px solid var(--gray-medium); {{item.completed ? 'background-color: #d2ffd9;' : 'background-color: white;'}}" wx:for="{{todayTasks}}" wx:key="id">
          <view class="task-check {{item.completed ? 'done' : 'undone'}}" 
                style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; {{item.completed ? 'background-color: var(--secondary);' : 'background-color: #fff5e5; border: 2rpx solid var(--gray-medium)'}}"
                bindtap="toggleTaskCompletion" data-id="{{item.id}}">
            <icon type="success" size="16" color="white" wx:if="{{item.completed}}" />
          </view>
          <view class="task-info" style="flex: 1;">
            <text class="task-name" style="font-size: 15px; display: block; {{item.completed ? 'text-decoration: line-through; color: var(--gray-dark);' : ''}}">{{item.name}}</text>
            <text class="task-detail" style="font-size: 13px; color: var(--gray-dark);">{{item.sets}} 组 × {{item.reps}}</text>            
            <text style="font-size: 12px; color:#4A90E2;" class="click-text" bindtap="openModal" data-desc="{{item.description}}" data-diffic="{{item.difficulty}}">\n查看详情> 
            </text>
          </view>       
          <text class="task-status {{item.completed ? 'done' : 'undone'}}" style="font-size: 14px; {{item.completed ? 'color: var(--secondary);' : 'color: var(--gray-dark);'}}">{{item.completed ? '已完成' : '未完成'}}</text>
        </view>
      </view>
    </view>

    <!-- 每日计划选项卡3 -->
    <view class="tab-content" wx:if="{{currentDay === 2}}">
      <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color:#fff5e5"> 
        <!-- 今日任务 -->
        <view class="task-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <text style="font-size: 16px; font-weight: 600;">{{(currentDay === oldDay) ? '本日计划' : '周三计划'}}</text>
          <text class="task-count" style="font-size: 14px; {{tasksCompleted === totalTasks ? 'color: var(--secondary);' : 'color: var(--primary);'}}">{{tasksCompleted}}/{{totalTasks}}</text>
        </view>
        <view style="display: flex;">
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:if="{{currentDay < oldDay}}">已完成</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:elif="{{currentDay > oldDay}}">待设定</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:else >正在进行</text>
        </view>
        <!-- 可勾画任务栏核心 -->
        <view class="stage-info card card-shadow" style="display: flex; align-items: center; padding:15px 10px; border-bottom: 0.5px solid var(--gray-medium); {{item.completed ? 'background-color: #d2ffd9;' : 'background-color: white;'}}" wx:for="{{todayTasks}}" wx:key="id">
          <view class="task-check {{item.completed ? 'done' : 'undone'}}" 
                style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; {{item.completed ? 'background-color: var(--secondary);' : 'background-color: #fff5e5; border: 2rpx solid var(--gray-medium)'}}"
                bindtap="toggleTaskCompletion" data-id="{{item.id}}">
            <icon type="success" size="16" color="white" wx:if="{{item.completed}}" />
          </view>
          <view class="task-info" style="flex: 1;">
            <text class="task-name" style="font-size: 15px; display: block; {{item.completed ? 'text-decoration: line-through; color: var(--gray-dark);' : ''}}">{{item.name}}</text>
            <text class="task-detail" style="font-size: 13px; color: var(--gray-dark);">{{item.sets}} 组 × {{item.reps}}</text>            
            <text style="font-size: 12px; color:#4A90E2;" class="click-text" bindtap="openModal" data-desc="{{item.description}}" data-diffic="{{item.difficulty}}">\n查看详情> 
            </text>
          </view>       
          <text class="task-status {{item.completed ? 'done' : 'undone'}}" style="font-size: 14px; {{item.completed ? 'color: var(--secondary);' : 'color: var(--gray-dark);'}}">{{item.completed ? '已完成' : '未完成'}}</text>
        </view>
      </view>
    </view>

        <!-- 每日计划选项卡4 -->
    <view class="tab-content" wx:if="{{currentDay === 3}}">
      <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color:#fff5e5"> 
        <!-- 今日任务 -->
        <view class="task-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <text style="font-size: 16px; font-weight: 600;">{{(currentDay === oldDay) ? '本日计划' : '周四计划'}}</text>
          <text class="task-count" style="font-size: 14px; {{tasksCompleted === totalTasks ? 'color: var(--secondary);' : 'color: var(--primary);'}}">{{tasksCompleted}}/{{totalTasks}}</text>
        </view>
        <view style="display: flex;">
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:if="{{currentDay < oldDay}}">已完成</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:elif="{{currentDay > oldDay}}">待设定</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:else >正在进行</text>
        </view>
        <!-- 可勾画任务栏核心 -->
        <view class="stage-info card card-shadow" style="display: flex; align-items: center; padding:15px 10px; border-bottom: 0.5px solid var(--gray-medium); {{item.completed ? 'background-color: #d2ffd9;' : 'background-color: white;'}}" wx:for="{{todayTasks}}" wx:key="id">
          <view class="task-check {{item.completed ? 'done' : 'undone'}}" 
                style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; {{item.completed ? 'background-color: var(--secondary);' : 'background-color: #fff5e5; border: 2rpx solid var(--gray-medium)'}}"
                bindtap="toggleTaskCompletion" data-id="{{item.id}}">
            <icon type="success" size="16" color="white" wx:if="{{item.completed}}" />
          </view>
          <view class="task-info" style="flex: 1;">
            <text class="task-name" style="font-size: 15px; display: block; {{item.completed ? 'text-decoration: line-through; color: var(--gray-dark);' : ''}}">{{item.name}}</text>
            <text class="task-detail" style="font-size: 13px; color: var(--gray-dark);">{{item.sets}} 组 × {{item.reps}}</text>            
            <text style="font-size: 12px; color:#4A90E2;" class="click-text" bindtap="openModal" data-desc="{{item.description}}" data-diffic="{{item.difficulty}}">\n查看详情> 
            </text>
          </view>       
          <text class="task-status {{item.completed ? 'done' : 'undone'}}" style="font-size: 14px; {{item.completed ? 'color: var(--secondary);' : 'color: var(--gray-dark);'}}">{{item.completed ? '已完成' : '未完成'}}</text>
        </view>
      </view>
    </view>

        <!-- 每日计划选项卡5 -->
    <view class="tab-content" wx:if="{{currentDay === 4}}">
      <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color:#fff5e5"> 
        <!-- 今日任务 -->
        <view class="task-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <text style="font-size: 16px; font-weight: 600;">{{(currentDay === oldDay) ? '本日计划' : '周五计划'}}</text>
          <text class="task-count" style="font-size: 14px; {{tasksCompleted === totalTasks ? 'color: var(--secondary);' : 'color: var(--primary);'}}">{{tasksCompleted}}/{{totalTasks}}</text>
        </view>
        <view style="display: flex;">
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:if="{{currentDay < oldDay}}">已完成</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:elif="{{currentDay > oldDay}}">待设定</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:else >正在进行</text>
        </view>
        <!-- 可勾画任务栏核心 -->
        <view class="stage-info card card-shadow" style="display: flex; align-items: center; padding:15px 10px; border-bottom: 0.5px solid var(--gray-medium); {{item.completed ? 'background-color: #d2ffd9;' : 'background-color: white;'}}" wx:for="{{todayTasks}}" wx:key="id">
          <view class="task-check {{item.completed ? 'done' : 'undone'}}" 
                style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; {{item.completed ? 'background-color: var(--secondary);' : 'background-color: #fff5e5; border: 2rpx solid var(--gray-medium)'}}"
                bindtap="toggleTaskCompletion" data-id="{{item.id}}">
            <icon type="success" size="16" color="white" wx:if="{{item.completed}}" />
          </view>
          <view class="task-info" style="flex: 1;">
            <text class="task-name" style="font-size: 15px; display: block; {{item.completed ? 'text-decoration: line-through; color: var(--gray-dark);' : ''}}">{{item.name}}</text>
            <text class="task-detail" style="font-size: 13px; color: var(--gray-dark);">{{item.sets}} 组 × {{item.reps}}</text>            
            <text style="font-size: 12px; color:#4A90E2;" class="click-text" bindtap="openModal" data-desc="{{item.description}}" data-diffic="{{item.difficulty}}">\n查看详情> 
            </text>
          </view>       
          <text class="task-status {{item.completed ? 'done' : 'undone'}}" style="font-size: 14px; {{item.completed ? 'color: var(--secondary);' : 'color: var(--gray-dark);'}}">{{item.completed ? '已完成' : '未完成'}}</text>
        </view>
      </view>
    </view>

        <!-- 每日计划选项卡6 -->
    <view class="tab-content" wx:if="{{currentDay === 5}}">
      <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color:#fff5e5"> 
        <!-- 今日任务 -->
        <view class="task-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <text style="font-size: 16px; font-weight: 600;">{{(currentDay === oldDay) ? '本日计划' : '周六计划'}}</text>
          <text class="task-count" style="font-size: 14px; {{tasksCompleted === totalTasks ? 'color: var(--secondary);' : 'color: var(--primary);'}}">{{tasksCompleted}}/{{totalTasks}}</text>
        </view>
        <view style="display: flex;">
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:if="{{currentDay < oldDay}}">已完成</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:elif="{{currentDay > oldDay}}">待设定</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:else >正在进行</text>
        </view>
        <!-- 可勾画任务栏核心 -->
        <view class="stage-info card card-shadow" style="display: flex; align-items: center; padding:15px 10px; border-bottom: 0.5px solid var(--gray-medium); {{item.completed ? 'background-color: #d2ffd9;' : 'background-color: white;'}}" wx:for="{{todayTasks}}" wx:key="id">
          <view class="task-check {{item.completed ? 'done' : 'undone'}}" 
                style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; {{item.completed ? 'background-color: var(--secondary);' : 'background-color: #fff5e5; border: 2rpx solid var(--gray-medium)'}}"
                bindtap="toggleTaskCompletion" data-id="{{item.id}}">
            <icon type="success" size="16" color="white" wx:if="{{item.completed}}" />
          </view>
          <view class="task-info" style="flex: 1;">
            <text class="task-name" style="font-size: 15px; display: block; {{item.completed ? 'text-decoration: line-through; color: var(--gray-dark);' : ''}}">{{item.name}}</text>
            <text class="task-detail" style="font-size: 13px; color: var(--gray-dark);">{{item.sets}} 组 × {{item.reps}}</text>            
            <text style="font-size: 12px; color:#4A90E2;" class="click-text" bindtap="openModal" data-desc="{{item.description}}" data-diffic="{{item.difficulty}}">\n查看详情> 
            </text>
          </view>       
          <text class="task-status {{item.completed ? 'done' : 'undone'}}" style="font-size: 14px; {{item.completed ? 'color: var(--secondary);' : 'color: var(--gray-dark);'}}">{{item.completed ? '已完成' : '未完成'}}</text>
        </view>
      </view>
    </view>   

        <!-- 每日计划选项卡7 -->
    <view class="tab-content" wx:if="{{currentDay === 6}}">
      <view class="stage-info card card-shadow" style="margin-bottom: 24px; background-color:#fff5e5"> 
        <!-- 今日任务 -->
        <view class="task-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <text style="font-size: 16px; font-weight: 600;">{{(currentDay === oldDay) ? '本日计划' : '周日计划'}}</text>
          <text class="task-count" style="font-size: 14px; {{tasksCompleted === totalTasks ? 'color: var(--secondary);' : 'color: var(--primary);'}}">{{tasksCompleted}}/{{totalTasks}}</text>
        </view>
        <view style="display: flex;">
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:if="{{currentDay < oldDay}}">已完成</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:elif="{{currentDay > oldDay}}">待设定</text>
          <text style="font-size: 16px; font-weight: 600; margin-bottom: 10px;" wx:else >正在进行</text>
        </view>
        <!-- 可勾画任务栏核心 -->
        <view class="stage-info card card-shadow" style="display: flex; align-items: center; padding:15px 10px; border-bottom: 0.5px solid var(--gray-medium); {{item.completed ? 'background-color: #d2ffd9;' : 'background-color: white;'}}" wx:for="{{todayTasks}}" wx:key="id">
          <view class="task-check {{item.completed ? 'done' : 'undone'}}" 
                style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; {{item.completed ? 'background-color: var(--secondary);' : 'background-color: #fff5e5; border: 2rpx solid var(--gray-medium)'}}"
                bindtap="toggleTaskCompletion" data-id="{{item.id}}">
            <icon type="success" size="16" color="white" wx:if="{{item.completed}}" />
          </view>
          <view class="task-info" style="flex: 1;">
            <text class="task-name" style="font-size: 15px; display: block; {{item.completed ? 'text-decoration: line-through; color: var(--gray-dark);' : ''}}">{{item.name}}</text>
            <text class="task-detail" style="font-size: 13px; color: var(--gray-dark);">{{item.sets}} 组 × {{item.reps}}</text>            
            <text style="font-size: 12px; color:#4A90E2;" class="click-text" bindtap="openModal" data-desc="{{item.description}}" data-diffic="{{item.difficulty}}">\n查看详情> 
            </text>
          </view>       
          <text class="task-status {{item.completed ? 'done' : 'undone'}}" style="font-size: 14px; {{item.completed ? 'color: var(--secondary);' : 'color: var(--gray-dark);'}}">{{item.completed ? '已完成' : '未完成'}}</text>
        </view>
      </view>
    </view>

    <view class="exercise-list">
      <view class="exercise-item card card-shadow" wx:for="{{currentDayExercises}}" wx:key="id" 
            style="display: flex; padding: 16px; margin-bottom: 16px; border-radius: 12px; background-color: white;">
        <view class="exercise-icon" style="width: 48px; height: 48px; border-radius: 8px; background-color: #E8F4FD; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
          <icon type="success" size="24" color="#4A90E2" />
        </view>
        <view class="exercise-info" style="flex: 1;">
          <view style="display: flex; justify-content: space-between; align-items: flex-start;">
            <text class="exercise-name" style="font-size: 16px; font-weight: 600; display: block;">{{item.name}}</text>
            <view class="difficulty-tag" style="padding: 2px 8px; border-radius: 12px; font-size: 12px; {{item.difficulty === '初级' ? 'background-color: #E6F7F0; color: #4CD964;' : item.difficulty === '中级' ? 'background-color: #E8F4FD; color: #4A90E2;' : 'background-color: #FFEBE6; color: #FF6B6B;'}}">
              {{item.difficulty}}
            </view>
          </view>
          <text class="exercise-target" style="font-size: 14px; color: var(--gray-dark); display: block; margin: 4px 0;">目标：{{item.target}}</text>
          <text class="exercise-sets" style="font-size: 14px; color: var(--gray-dark); display: block;">训练量：{{item.sets}} 组 × {{item.reps}}</text>
          
          <view class="exercise-actions" style="display: flex; margin-top: 12px;">
            <button class="play-btn" bindtap="playExerciseVideo" data-id="{{item.id}}" 
                    style="display: flex; align-items: center; padding: 6px 12px; background-color: var(--primary); color: white; border-radius: 6px; font-size: 14px;">
              <icon type="playcircle" size="16" style="margin-right: 4px;" /> 示范视频
            </button>
            <button class="log-btn" bindtap="goToLogExercise" data-id="{{item.id}}" 
                    style="display: flex; align-items: center; padding: 6px 12px; background-color: transparent; color: var(--primary); border: 1px solid var(--primary); border-radius: 6px; font-size: 14px; margin-left: 12px;">
              <icon type="edit" size="16" style="margin-right: 4px;" /> 记录
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 注意事项 -->
  <view class="notes-section section">
    <text class="section-title">训练注意事项</text>
    <view class="notes-card card card-shadow"
    style="background-color: #fff5e5">
      <view class="note-item" style="display: flex; margin-bottom: 16px;">
        <view class="note-icon" style="width: 24px; height: 24px; border-radius: 50%; background-color: #FFEBE6; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0;">
          <icon type="warn" size="16" color="#FF6B6B" />
        </view>
        <text class="note-text" style="font-size: 14px; color: var(--gray-dark);">训练时疼痛应控制在3分以内（0-10分评分法），如超过应立即停止</text>
      </view>
      <view class="note-item" style="display: flex; margin-bottom: 16px;">
        <view class="note-icon" style="width: 24px; height: 24px; border-radius: 50%; background-color: #FFEBE6; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0;">
          <icon type="warn" size="16" color="#FF6B6B" />
        </view>
        <text class="note-text" style="font-size: 14px; color: var(--gray-dark);">每次训练后应进行冰敷15-20分钟，以减轻肿胀和疼痛</text>
      </view>
      <view class="note-item" style="display: flex; margin-bottom: 16px;">
        <view class="note-icon" style="width: 24px; height: 24px; border-radius: 50%; background-color: #FFEBE6; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0;">
          <icon type="warn" size="16" color="#FF6B6B" />
        </view>
        <text class="note-text" style="font-size: 14px; color: var(--gray-dark);">如出现关节卡住、弹响加重或肿胀明显增加，应暂停训练并咨询医生</text>
      </view>
      <view class="note-item" style="display: flex;">
        <view class="note-icon" style="width: 24px; height: 24px; border-radius: 50%; background-color: #E6F7F0; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0;">
          <icon type="info" size="16" color="#4CD964" />
        </view>
        <text class="note-text" style="font-size: 14px; color: var(--gray-dark);">建议每天饮水量保持在2000ml以上，有助于减轻炎症和促进恢复</text>
      </view>
    </view>
  </view>
  
  <!-- 医生提示 -->
  <view class="doctor-tip card card-shadow" style="margin-top: 24px; background-color: #E8F4FD; border-left: 4px solid var(--primary);">
    <view style="display: flex; align-items: flex-start;">
      <view style="width: 36px; height: 36px; border-radius: 50%; background-color: white; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0;">
        <icon type="success" size="20" color="#4A90E2" />
      </view>
      <view>
        <text style="font-size: 15px; font-weight: 600; display: block; margin-bottom: 4px;">医生提示</text>
        <text style="font-size: 14px; color: var(--gray-dark); line-height: 1.5;">
        {{doctorTip || '正在获取医生提示...'}}
        </text>
      </view>
    </view>
  </view>

  <!-- 自定义弹窗 -->
  <view class="modal-mask" wx:if="{{showModal}}">
    <view class="modal-box">
      <!-- 自定义弹窗内容 -->
      <view class="modal-header" style="background-color: var(--primary); color: white">训练指导
      </view>
      <view class="modal-content">
        <text>{{modalDiffic}}\n{{modalDesc}}</text>
      </view>
      <!-- 弹窗下部可以不要 -->
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="closeModal">取消</button>
        <button class="modal-btn confirm">立即咨询</button>
      </view>
    </view>
  </view>
</view>